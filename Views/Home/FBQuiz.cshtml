@{
    Layout = null;
}

<style>
    /* Common styles for all screen sizes */
    .modal-title {
        font-size: 5vw; /* Adjusted font size for smaller screens */
        margin-bottom: -1px;
        color: white;
        font-weight: 400;
    }

    .modal-body1 {
        position: relative;
        flex: 1 1 auto;
        padding: 2rem;
        /* top: 30vh; */
        background: #005aff;
        border-radius: 5vw;
        width: 88%;
        /* left: 8vw; */
        margin: 5vh auto 0;
    }

    .custom-textbox {
        margin-bottom: 15px;
    }

    input[type="text"] {
        width: 100%;
        padding: 1vh;
        margin-bottom: 16px;
        box-sizing: border-box;
        border: 2px solid #357d93;
        border-radius: 1vw;
        font-size: 3vh;
        font-weight: 500;
    }

    .button {
        background-color: #005aff;
        color: #fff;
        /* padding: 10px 15px; */
        border: none;
        border-radius: 65px;
        cursor: pointer;
        position: relative;
        /* top: 75vh; */
        height: 11vh;
        width: 47%;
        /* left: 38vw; */
        font-size: 3vh;
        margin: 5vh auto;
        text-align: center;
        display: block;
    }

        button:hover {
            background-color: #357d93;
        }
    /* Add some distance between each textbox */
    .custom-textbox {
        margin-bottom: 20px; /* Increased margin for more spacing */
    }

    /* Header style */
    .header {
        background-color: #0078ff;
        padding: 7rem;
        color: white;
        text-align: center;
        font-size: 5vh;
        border-radius: -2vw;
        /* width: 100%; */
        /* position: absolute; */
    }

    .form-group1 {
        margin-bottom: 4rem;
    }

    .modal-body1 {
        position: relative;
        flex: 1 1 auto;
        padding: 3vh;
    }
</style>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

<div class="header">
    FaceBook কুইজ
</div>


        <div class="modal-body1">
            <div class="form-group1">
        <input id="nameField" type="text" class="form-control custom-textbox border border-danger" placeholder="আপনার নাম লিখুন">
        </div>
        <div class="form-group1">
        <input id="numberField" type="number" class="form-control custom-textbox border border-danger" style="height: 8vh;font-size: 3.5vh;border-radius: 1vh;" placeholder="মোবাইল নাম্বার লিখুন">
        </div>

    <div class="form-group1">
        <input id="answerField" type="text" class="form-control custom-textbox border border-danger" placeholder="প্রশ্নের উত্তর লিখুন">
    </div>


</div>

<button class="button" onclick="submitAnswer()">
    সাবমিট করুন
</button>
<div class="custom-popup" id="customPopup">
    <div class="custom-popup-content">
        <div class="custom-popup-header">
            <h5 class="custom-popup-title"></h5>
            <button class="custom-popup-close" onclick="closeCustomPopup()">&times;</button>
        </div>
        <div class="custom-popup-body">
            <p id="customPopupMessage" style="font-size:3vh;"></p>
        </div>
        <div class="custom-popup-footer">
            <button class="custom-popup-btn" onclick="closeCustomPopup()">বন্ধ করুন</button>
        </div>
    </div>
</div>

<style>
    .custom-popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .custom-popup-content {
    background: #fff;
    border-radius: 2vh;
    overflow: hidden;
    width: 53vh;
    /* max-width: 574px; */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    position: absolute;
    left: 2vh;
    height: 41vh;
    top: 5vh;
    margin: 0 auto;
    }

    .custom-popup-header {
        background: #0078ff;
        color: white;
        padding: 33px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .custom-popup-title {
        margin: 0;
        font-size: 18px;
    }

    .custom-popup-close {
    background: none;
    border: none;
    color: white;
    font-size: 3vh;
    cursor: pointer;
    }

    .custom-popup-body {
        padding: 20px;
    }

    .custom-popup-footer {
        background: #f2f2f2;
        padding: 10px;
        text-align: center;
    }

    .custom-popup-btn {
        background: #0078ff;
        color: white;
        border: none;
        padding: 25px 98px;
        border-radius: 5px;
        cursor: pointer;
        font-size:3vh;

    }
</style>

<script>
    function openCustomPopup(message) {
        var customPopup = document.getElementById("customPopup");
        var customPopupMessage = document.getElementById("customPopupMessage");
        customPopupMessage.innerText = message;
        customPopup.style.display = "flex";
    }

    function closeCustomPopup() {
        window.location.href = "../Home/FBQuiz";
    }
</script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
}
<script>
    //function submitAnswer() {
    //    var nameField = document.getElementById("nameField");
    //    var nameValue = nameField.value.trim();
    //    var nameRegex = /^[A-Za-z\s]+$/;

    //    var numberField = document.getElementById("numberField");
    //    var numberValue = numberField.value.trim();
    //    var numberRegex = /^\d+$/;

    //    var answerField = document.getElementById("answerField");
    //    var answerValue = answerField.value.trim();

    //    var customPopupMessage = document.getElementById("customPopupMessage");
    //    var customPopup = new bootstrap.Modal(document.getElementById('customPopup'));

    //    if (!nameRegex.test(nameValue)) {
    //        customPopupMessage.innerText = "আপনার নামটি সঠিক নয়। কেবল অক্ষর ব্যাবহার করুন।";
    //        customPopup.show();
    //        return;
    //    }

    //    if (!numberRegex.test(numberValue)) {
    //        customPopupMessage.innerText = "আপনার মোবাইল নাম্বারটি সঠিক নয়। কেবল সংখ্যা ব্যাবহার করুন।";
    //        customPopup.show();
    //        return;
    //    }

    //    if (nameValue === "" || numberValue === "" || answerValue === "") {
    //        customPopupMessage.innerText = "সব প্রশ্নের উত্তর দিন।";
    //        customPopup.show();
    //        return;
    //    }

    //    var number = $('#numberValue').val();
    //    if (!number.startsWith('880')) {
    //            if (number.startsWith('0')) {
    //                number = '88' + number;

    //            }
    //            else {
    //                number = '880' + number;

    //            }
    //        }
         
    //     if (number.length == 13) {

    //            sessionStorage.setItem("fbid", number);
    //            sessionStorage.setItem("username", username);
    //            sessionStorage.setItem("isLogin", "Yes")
    //            sessionStorage.setItem("serviceName", "QuizMaster")

    //            localStorage.setItem("fbid", number);
    //            localStorage.setItem("username", username);
         
    //     var data = {
    //        "fbid": number
    //       }

    //    $.ajax({

    //        type: "GET",
    //        url: '../Landingpage/IsSubscribedForMultiTournament?fbid=' + number + "&serviceName=QuizMaster",
    //        contentType: "application/json; charset=utf-8",
    //        dataType: "json",
    //        success: function (rdata) {
    //            if (rdata.result === false) {

    //                let fbid = sessionStorage.getItem('fbid');

    //                $.get("../LandingPage/SaveCapmLog?msisdn=" + sessionStorage.getItem("fbid") + "&ckey=" + sessionStorage.getItem("ckey") + "&cname=" + "KidStar" + "&theme=FBQuiz&srcurl=" + sessionStorage.getItem("sourceURL"), function (rData) { });



    //                $.post("../Home/CreateCheckoutUrlMultiTournamentHardCode?msisdn=" + sessionStorage.getItem("fbid") + "&serviceName=QuizMaster" + "&ckey=" + sessionStorage.getItem("ckey"), function (data) {


    //                    window.location.href = data;
    //                });

    //            }
    //            else if (rdata.result === true) {
    //                $.ajax({
    //                    url: `../Home/InsertFB?name=${encodeURIComponent(nameValue)}&number=${encodeURIComponent(number)}&answer=${encodeURIComponent(answerValue)}`,
    //                    type: 'GET',
    //                    contentType: 'application/json',
    //                    success: function (data) {
    //                        // Handle success response from the API
    //                        if (data.success) {
    //                            customPopupMessage.innerText = "আপনার উত্তরটি গৃহীত হয়েছে!";
    //                        } else {
    //                            customPopupMessage.innerText = "আপনার উত্তরটি গ্রহণ করা যাচ্ছে না! " + data.message;
    //                        }
    //                        customPopup.show();
    //                    },
    //                    error: function (error) {
    //                        // Handle error response from the API
    //                        customPopupMessage.innerText = "আপনার উত্তরটি গ্রহণ করা যাচ্ছে না!";
    //                        customPopup.show();
    //                    }
    //                });

    //            }
    //        }
    //    });


    //}
    function submitAnswer() {
        var nameField = document.getElementById("nameField");
        var nameValue = nameField.value.trim();
        var nameRegex = /^[A-Za-z\s]+$/;

        var numberField = document.getElementById("numberField");
        var numberValue = numberField.value.trim();
        var numberRegex = /^\d+$/;

        var answerField = document.getElementById("answerField");
        var answerValue = answerField.value.trim();

        var customPopupMessage = document.getElementById("customPopupMessage");
        var customPopup = new bootstrap.Modal(document.getElementById('customPopup'));

        if (!nameRegex.test(nameValue)) {
            customPopupMessage.innerText = "আপনার নামটি সঠিক নয়। কেবল অক্ষর ব্যবহার করুন।";
            customPopup.show();
            return;
        }

        if (!numberRegex.test(numberValue)) {
            customPopupMessage.innerText = "আপনার মোবাইল নাম্বারটি সঠিক নয়। কেবল সংখ্যা ব্যবহার করুন।";
            customPopup.show();
            return;
        }

        if (nameValue === "" || numberValue === "" || answerValue === "") {
            customPopupMessage.innerText = "সব প্রশ্নের উত্তর দিন।";
            customPopup.show();
            return;
        }
        $.get("../LandingPage/SaveCapmLog?msisdn=" + number + "&ckey=" + sessionStorage.getItem("ckey") + "&cname=QuizMaster&theme=FBQuizPlayed&srcurl=" + sessionStorage.getItem("sourceURL"), function (rData) {
                         
                        });
        var number = numberValue;

        if (!number.startsWith('880')) {
            if (number.startsWith('0')) {
                number = '88' + number;
            } else {
                number = '880' + number;
            }
        }

        if (number.length === 13) {
            sessionStorage.setItem("fbid", number);
            // Assuming 'username' is defined somewhere in your code
            var username = "your_username"; // Replace with your actual username
            sessionStorage.setItem("username", username);
            sessionStorage.setItem("isLogin", "Yes");
            sessionStorage.setItem("serviceName", "QuizMaster");
            localStorage.setItem("fbid", number);
            localStorage.setItem("username", username);
            

            var data = {
                "fbid": number
            };

            $.ajax({
                type: "GET",
                url: '../Landingpage/IsSubscribedForMultiTournament?fbid=' + number + "&serviceName=QuizMaster",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (rdata) {
                    if (!rdata.result) {
                       
                        let fbid = sessionStorage.getItem('fbid');

                        $.get("../LandingPage/SaveCapmLog?msisdn=" + sessionStorage.getItem("fbid") + "&ckey=" + sessionStorage.getItem("ckey") + "&cname=" + "QuizMasterFB" + "&theme=clicked_CampaignImage&srcurl=" + sessionStorage.getItem("sourceURL"), function (rData) { });

                        $.ajax({
                            url: "../HOME/GenerateUniQueSubscriptionRequestIdForCampaign",
                            type: "GET",
                            async: false,
                            data: {
                                ckey: sessionStorage.getItem("ckey"),
                                msisdn: sessionStorage.getItem("fbid")
                            },
                            success: function (rData) {
                                localStorage.setItem("UserPacket", rData);
                                $.post("../Home/MultiTournamentInBuildCheckoutUrl?packetData=" + localStorage.getItem("UserPacket"), function (data) {

                                    window.parent.location.href = data;
                                });
                            }
                        });

                        //$.post("../Home/CreateCheckoutUrlMultiTournamentHardCode?msisdn=" + number + "&serviceName=QuizMaster&ckey=" + sessionStorage.getItem("ckey"), function (data) {
                        //    window.location.href = data;
                        //});
                    } else {
                        $.ajax({
                            url: `../Home/InsertFB?name=${encodeURIComponent(nameValue)}&number=${encodeURIComponent(number)}&answer=${encodeURIComponent(answerValue)}`,
                            type: 'GET',
                            contentType: 'application/json',
                            success: function (data) {
                                if (data.success) {
                                    customPopupMessage.innerText = "আপনার উত্তরটি গৃহীত হয়েছে!";
                                } else {
                                    customPopupMessage.innerText = "আপনার উত্তরটি গ্রহণ করা যাচ্ছে না! " + data.message;
                                }
                                customPopup.show();
                            },
                            error: function (error) {
                                customPopupMessage.innerText = "আপনার উত্তরটি গ্রহণ করা যাচ্ছে না!";
                                customPopup.show();
                            }
                        });
                    }
                }
            });
        }
    }

</script>
